# 10강. (데모) 데이터베이스 생성 및 연결
    
## Subnet 생성

우선, 데이터베이스를 VPC 내 Private 네트워크로 연결시킬 예정이기에, Private Subnet을 생성해야 합니다.

VPC→Subnet→Subnet 생성

![Untitled](10%E1%84%80%E1%85%A1%E1%86%BC%20(%E1%84%83%E1%85%A6%E1%84%86%E1%85%A9)%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%E1%84%87%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%89%E1%85%A2%E1%86%BC%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8B%E1%85%A7%E1%86%AB%E1%84%80%E1%85%A7%E1%86%AF%20b7da476abbaf45ee89505529c4920f6b/Untitled.png)

## Cloud DB for MySQL

![Untitled](10%E1%84%80%E1%85%A1%E1%86%BC%20(%E1%84%83%E1%85%A6%E1%84%86%E1%85%A9)%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%E1%84%87%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%89%E1%85%A2%E1%86%BC%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8B%E1%85%A7%E1%86%AB%E1%84%80%E1%85%A7%E1%86%AF%20b7da476abbaf45ee89505529c4920f6b/Untitled%201.png)

Services 메뉴에서 Cloud DB for MySQL을 선택해줍니다. MySQL 외에도 MSSQL, MongoDB, PostgreSQL, Redis 등 자주 사용되는 거의 대부분이 지원됩니다.

![Untitled](10%E1%84%80%E1%85%A1%E1%86%BC%20(%E1%84%83%E1%85%A6%E1%84%86%E1%85%A9)%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%E1%84%87%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%89%E1%85%A2%E1%86%BC%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8B%E1%85%A7%E1%86%AB%E1%84%80%E1%85%A7%E1%86%AF%20b7da476abbaf45ee89505529c4920f6b/Untitled%202.png)

DB 서버 생성 버튼을 누릅니다.

![Untitled](10%E1%84%80%E1%85%A1%E1%86%BC%20(%E1%84%83%E1%85%A6%E1%84%86%E1%85%A9)%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%E1%84%87%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%89%E1%85%A2%E1%86%BC%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8B%E1%85%A7%E1%86%AB%E1%84%80%E1%85%A7%E1%86%AF%20b7da476abbaf45ee89505529c4920f6b/Untitled%203.png)

여러 설정이 나오는데, 강의에서 나온 중요한 설정은 아래와 같습니다.

- VPC와 Subnet: 우리가 사용할 VPC, 그리고 방금 만든 Private DB Subnet을 선택합니다.
- Server 타입은 Standard
- 고가용성 지원: O 체크, Standby DB를 추가로 생성합니다
- 멀티존: Master DB 2대를 서로 다른 Zone에 생성하여 더 높은 고가용성을 유지합니다. 현재는 체크하지 않겠습니다
- 서버 이름과 서비스 이름은 ‘edu’로 지었습니다.

![Untitled](10%E1%84%80%E1%85%A1%E1%86%BC%20(%E1%84%83%E1%85%A6%E1%84%86%E1%85%A9)%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%E1%84%87%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%89%E1%85%A2%E1%86%BC%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8B%E1%85%A7%E1%86%AB%E1%84%80%E1%85%A7%E1%86%AF%20b7da476abbaf45ee89505529c4920f6b/Untitled%204.png)

기본 DB 명, USER_ID와 비밀번호를 설정하고, HOST IP는 모든 주소 허용(%)으로 설정하겠습니다.

나머지는 모두 기본으로 했습니다.

![Untitled](10%E1%84%80%E1%85%A1%E1%86%BC%20(%E1%84%83%E1%85%A6%E1%84%86%E1%85%A9)%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%E1%84%87%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%89%E1%85%A2%E1%86%BC%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8B%E1%85%A7%E1%86%AB%E1%84%80%E1%85%A7%E1%86%AF%20b7da476abbaf45ee89505529c4920f6b/Untitled%205.png)

### ACG 설정

데이터베이스 서버를 생성했으면 하나 해야할 게 있습니다. ACG 설정을 해주는 것입니다. 이전에 서버를 생성할 때는 ACG를 미리 생성해두었던 것과 달리 Cloud DB는 자동으로 ACG 설정을 해주지만, 문제는 기본 ACG는 자기 자신으로의 접속만 허용을 합니다.

그래서 이전에 만들어두었던 lab1 서버에서 데이터베이스 서버로 접속이 가능하도록 ACG를 수정해야 합니다.

Server→ACG 탭으로 가면 데이터베이스 서버가 생성한 기본 ACG가 보입니다. ACG 설정 버튼을 눌러서 수정합니다.

![Untitled](10%E1%84%80%E1%85%A1%E1%86%BC%20(%E1%84%83%E1%85%A6%E1%84%86%E1%85%A9)%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%E1%84%87%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%89%E1%85%A2%E1%86%BC%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8B%E1%85%A7%E1%86%AB%E1%84%80%E1%85%A7%E1%86%AF%20b7da476abbaf45ee89505529c4920f6b/Untitled%206.png)

![Untitled](10%E1%84%80%E1%85%A1%E1%86%BC%20(%E1%84%83%E1%85%A6%E1%84%86%E1%85%A9)%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%E1%84%87%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%89%E1%85%A2%E1%86%BC%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8B%E1%85%A7%E1%86%AB%E1%84%80%E1%85%A7%E1%86%AF%20b7da476abbaf45ee89505529c4920f6b/Untitled%207.png)

이때 위와 같이, IP 주소를 직접 넣어도 좋지만, 연결을 허용하고자 하는 서버들에 적용되어 있는 ACG 이름을 입력해도 됩니다. 그렇게 되면 서버들의 IP 주소를 하나하나 입력할 필요 없이, ACG가 적용된 서버 그룹들의 IP 주소가 자동으로 할당됩니다.

허용 포트를 3308로 하고 추가합니다. 그리고 적용을 누르면 이제 lab1 서버에서 데이터베이스 서버로 접속이 가능합니다.

![Untitled](10%E1%84%80%E1%85%A1%E1%86%BC%20(%E1%84%83%E1%85%A6%E1%84%86%E1%85%A9)%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%E1%84%87%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%89%E1%85%A2%E1%86%BC%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8B%E1%85%A7%E1%86%AB%E1%84%80%E1%85%A7%E1%86%AF%20b7da476abbaf45ee89505529c4920f6b/Untitled%208.png)

Cloud DB for MySQL → DB Server에서 방금 전 생성한 DB 서버를 클릭해보면 상세 정보를 볼 수 있는데, 여기에 Private 도메인이 있습니다. 바로 이것이 내부망에서 DB 서버로 접속하려고 할 때 사용할 도메인입니다.

한편 외부 서버에서 DB 서버에 접속하려면 Public Domain을 할당받아야 합니다. 그러려면 이전에 Private Subnet에서 DB 서버를 생성했던 것과 다르게, Public Subnet에서 DB 서버를 연결해야 합니다.

Private 도메인인 `db-hedlp.vpc-cdb.ntruss.com` 를 복사하고, 내부 서버망으로 접근해보겠습니다.

```bash
$ mysql -h db-hedlp.vpc-cdb.ntruss.com -u student -p
```

Password 입력해야 하구요.

이때 student는, 아까 전 DB 서버를 생성할 때 설정한 유저 정보입니다.

![Untitled](10%E1%84%80%E1%85%A1%E1%86%BC%20(%E1%84%83%E1%85%A6%E1%84%86%E1%85%A9)%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%E1%84%87%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%89%E1%85%A2%E1%86%BC%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8B%E1%85%A7%E1%86%AB%E1%84%80%E1%85%A7%E1%86%AF%20b7da476abbaf45ee89505529c4920f6b/Untitled%209.png)

뭐가 문제가 생겼네요. 응답이 돌아오지 않습니다. Server 접속은 되나 mysql DB에 연결이 되지 않는 것을 보면 ACG 혹은 서버 규칙 설정에 뭐가 문제가 있는 것 같습니다.

## Cloud DB 기능

![Untitled](10%E1%84%80%E1%85%A1%E1%86%BC%20(%E1%84%83%E1%85%A6%E1%84%86%E1%85%A9)%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%E1%84%87%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%20%E1%84%89%E1%85%A2%E1%86%BC%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%8B%E1%85%A7%E1%86%AB%E1%84%80%E1%85%A7%E1%86%AF%20b7da476abbaf45ee89505529c4920f6b/Untitled%2010.png)

한편 이전에 Cloud DB는 Failover 방지 등의 기능이 있다고 했는데요, 해당 기능은 DB 관리 탭에서 확인 가능합니다. 서비스 출시 이전 Failover 기능이 잘 작동하는 지 체크해볼 수 있고, 해당 테스트 시 1-2분 내로 Failover 상황에서 정상적으로 대처가 된다고 합니다.

Engine Upgrade도 해당 탭에서 확인할 수 있습니다.