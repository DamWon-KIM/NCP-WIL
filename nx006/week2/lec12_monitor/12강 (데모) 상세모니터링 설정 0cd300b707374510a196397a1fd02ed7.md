# 12강. (데모) 상세모니터링 설정

NCP의 Management 서비스를 이용해봅시다.

Services→Management & Governance→Cloud Insight(Monitoring) 탭을 들어갑니다.

## Notification Recipient 설정

먼저 Notification Recipient에 들어가서, 클라우드 사용에 관한 SNS, 이메일 등의 알람을 받을 대상자를 지정합니다.

![Untitled](12%E1%84%80%E1%85%A1%E1%86%BC%20(%E1%84%83%E1%85%A6%E1%84%86%E1%85%A9)%20%E1%84%89%E1%85%A1%E1%86%BC%E1%84%89%E1%85%A6%E1%84%86%E1%85%A9%E1%84%82%E1%85%B5%E1%84%90%E1%85%A5%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%200cd300b707374510a196397a1fd02ed7/Untitled.png)

관리자의 번호, 이메일 등을 추가해놓을 수 있습니다.

대상자 그룹을 추가할 수 있는데, 여기서 Admin이라는 그룹을 추가한 후, 저의 계정을 Admin 그룹에 추가해놓았습니다.

## Event Rule 설정

이제 서버에서 어떤 임계치에 도달했을 때 알람을 보낼 것인지 설정을 할 수 있다.

![Untitled](12%E1%84%80%E1%85%A1%E1%86%BC%20(%E1%84%83%E1%85%A6%E1%84%86%E1%85%A9)%20%E1%84%89%E1%85%A1%E1%86%BC%E1%84%89%E1%85%A6%E1%84%86%E1%85%A9%E1%84%82%E1%85%B5%E1%84%90%E1%85%A5%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%200cd300b707374510a196397a1fd02ed7/Untitled%201.png)

Cloud Insight→Configuration→Event Rule로 간다. 해당 페이지에 Event Rule 생성 버튼을 클릭한다.

![Untitled](12%E1%84%80%E1%85%A1%E1%86%BC%20(%E1%84%83%E1%85%A6%E1%84%86%E1%85%A9)%20%E1%84%89%E1%85%A1%E1%86%BC%E1%84%89%E1%85%A6%E1%84%86%E1%85%A9%E1%84%82%E1%85%B5%E1%84%90%E1%85%A5%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%200cd300b707374510a196397a1fd02ed7/Untitled%202.png)

어떤 종류의 모니터링을 할 수 있는지 상품이 나온다. 강의에서는 서버를 대상으로 모니터링을 할 것이기에 Server(VPC)를 선택하고 다음을 누른다.

![Untitled](12%E1%84%80%E1%85%A1%E1%86%BC%20(%E1%84%83%E1%85%A6%E1%84%86%E1%85%A9)%20%E1%84%89%E1%85%A1%E1%86%BC%E1%84%89%E1%85%A6%E1%84%86%E1%85%A9%E1%84%82%E1%85%B5%E1%84%90%E1%85%A5%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%200cd300b707374510a196397a1fd02ed7/Untitled%203.png)

그룹 리스트가 나오고, 상단의 그룹 생성하기 버튼을 클릭하면 그룹 설정 페이지가 나온다. 이때 이름을 정하고, 감시 가능한 서버를 감시 대상 목록으로 옮긴다. 그리고 생성을 클릭한다.

그리고 타겟 그룹을 선택하고 다음 버튼을 누른다.

이제 알람에 대한 템플릿을 설정해야 한다. 템플릿 생성 버튼을 누르면 아래와 같이 NCP에서 제공하는 메트릭들이 보인다.

![Untitled](12%E1%84%80%E1%85%A1%E1%86%BC%20(%E1%84%83%E1%85%A6%E1%84%86%E1%85%A9)%20%E1%84%89%E1%85%A1%E1%86%BC%E1%84%89%E1%85%A6%E1%84%86%E1%85%A9%E1%84%82%E1%85%B5%E1%84%90%E1%85%A5%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%200cd300b707374510a196397a1fd02ed7/Untitled%204.png)

여기서는 `MEMORY/mem_usert`(메모리 사용량), `SERVER/avg_cpu_used_to`(CPU 사용량)에 대해서 체크해준다. 이 외에도 원하는 정보를 체크하여 알림을 받을 수 있다.

![Untitled](12%E1%84%80%E1%85%A1%E1%86%BC%20(%E1%84%83%E1%85%A6%E1%84%86%E1%85%A9)%20%E1%84%89%E1%85%A1%E1%86%BC%E1%84%89%E1%85%A6%E1%84%86%E1%85%A9%E1%84%82%E1%85%B5%E1%84%90%E1%85%A5%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%200cd300b707374510a196397a1fd02ed7/Untitled%205.png)

알림 레벨(Info, Warning, Critical)을 설정할 수 있고, 임계 조건도 설정할 수 있다.

여기서는 메모리와 CPU 사용률을 각각 80% 이상으로 1분 간 지속될 때 경고(Warning) 레벨로 알림을 보내오게끔 설정하였다.

![Untitled](12%E1%84%80%E1%85%A1%E1%86%BC%20(%E1%84%83%E1%85%A6%E1%84%86%E1%85%A9)%20%E1%84%89%E1%85%A1%E1%86%BC%E1%84%89%E1%85%A6%E1%84%86%E1%85%A9%E1%84%82%E1%85%B5%E1%84%90%E1%85%A5%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%200cd300b707374510a196397a1fd02ed7/Untitled%206.png)

템플릿 설정을 맞추었으니 다음 버튼을 누른다.

![Untitled](12%E1%84%80%E1%85%A1%E1%86%BC%20(%E1%84%83%E1%85%A6%E1%84%86%E1%85%A9)%20%E1%84%89%E1%85%A1%E1%86%BC%E1%84%89%E1%85%A6%E1%84%86%E1%85%A9%E1%84%82%E1%85%B5%E1%84%90%E1%85%A5%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%200cd300b707374510a196397a1fd02ed7/Untitled%207.png)

이전에 만들어놓은 Admin 그룹을 선택하고 다음 버튼을 누른다. 룰 이름을 적는 칸이 나오는데, 이름만 지으면 끝이다. lab-rule이라고 짓고 생성 버튼을 누르자.

![Untitled](12%E1%84%80%E1%85%A1%E1%86%BC%20(%E1%84%83%E1%85%A6%E1%84%86%E1%85%A9)%20%E1%84%89%E1%85%A1%E1%86%BC%E1%84%89%E1%85%A6%E1%84%86%E1%85%A9%E1%84%82%E1%85%B5%E1%84%90%E1%85%A5%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%200cd300b707374510a196397a1fd02ed7/Untitled%208.png)

Event Rule이 생성된 것을 볼 수 있다.

## CLA 설정 (Cloud Log Analytics)

클라우드에서 발생하는 다양한 이벤트들에 대한 로그를 한 번에 모아서 관리할 수 있는 서비스입니다.

Services→Management & Governance → Cloud Log Analytics 로 이동합니다.

![Untitled](12%E1%84%80%E1%85%A1%E1%86%BC%20(%E1%84%83%E1%85%A6%E1%84%86%E1%85%A9)%20%E1%84%89%E1%85%A1%E1%86%BC%E1%84%89%E1%85%A6%E1%84%86%E1%85%A9%E1%84%82%E1%85%B5%E1%84%90%E1%85%A5%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%200cd300b707374510a196397a1fd02ed7/Untitled%209.png)

Management 탭에서 CLA 로그를 수집할 서버를 선택하고, 수집 설정을 누르면

![Untitled](12%E1%84%80%E1%85%A1%E1%86%BC%20(%E1%84%83%E1%85%A6%E1%84%86%E1%85%A9)%20%E1%84%89%E1%85%A1%E1%86%BC%E1%84%89%E1%85%A6%E1%84%86%E1%85%A9%E1%84%82%E1%85%B5%E1%84%90%E1%85%A5%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%200cd300b707374510a196397a1fd02ed7/Untitled%2010.png)

위와 같이 내가 어떤 로그를 수집할 것인지 템플릿을 설정할 수 있습니다.

![Untitled](12%E1%84%80%E1%85%A1%E1%86%BC%20(%E1%84%83%E1%85%A6%E1%84%86%E1%85%A9)%20%E1%84%89%E1%85%A1%E1%86%BC%E1%84%89%E1%85%A6%E1%84%86%E1%85%A9%E1%84%82%E1%85%B5%E1%84%90%E1%85%A5%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%200cd300b707374510a196397a1fd02ed7/Untitled%2011.png)

이렇게 이미 NCP에서 제공 중인 로그 템플릿을 이용할 수도 있고, 혹은 하단의 Custom Log 기능을 통해 커스텀된 로그를 직접 수집할 수도 있습니다.

![Untitled](12%E1%84%80%E1%85%A1%E1%86%BC%20(%E1%84%83%E1%85%A6%E1%84%86%E1%85%A9)%20%E1%84%89%E1%85%A1%E1%86%BC%E1%84%89%E1%85%A6%E1%84%86%E1%85%A9%E1%84%82%E1%85%B5%E1%84%90%E1%85%A5%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%200cd300b707374510a196397a1fd02ed7/Untitled%2012.png)

적용을 누르면, CLA 에이전트를 서버에 설치하기 위한 명령어가 나옵니다. 이를 복사해서 서버 터미널에 붙여넣어주면 됩니다.

![Untitled](12%E1%84%80%E1%85%A1%E1%86%BC%20(%E1%84%83%E1%85%A6%E1%84%86%E1%85%A9)%20%E1%84%89%E1%85%A1%E1%86%BC%E1%84%89%E1%85%A6%E1%84%86%E1%85%A9%E1%84%82%E1%85%B5%E1%84%90%E1%85%A5%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%89%E1%85%A5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%BC%200cd300b707374510a196397a1fd02ed7/Untitled%2013.png)

잘 설치가 된 것을 확인할 수 있습니다.